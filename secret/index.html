<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Embargo NFC Debug</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  * { box-sizing:border-box; font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif !important; }
  html,body { height:100%; margin:0; background:#f2f4f7; color:#111; -webkit-font-smoothing:antialiased; }
  
  #blockedDevice { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:#fff; z-index:9999; padding:20px; text-align:center; }
  #blockedDevice-inner { max-width:420px; width:100%; border-radius:14px; padding:28px; box-shadow:0 8px 30px rgba(13,38,76,0.08); background:linear-gradient(180deg,#fff,#fbfdff); }
  #blockedDevice h1 { margin:0 0 8px; font-size:20px; font-weight:600; }
  #blockedDevice p { margin:0; color:#475569; font-size:15px; line-height:1.4; }

  .container { max-width:920px; margin:18px auto; background:#fff; border-radius:14px; padding:18px; box-shadow:0 6px 20px rgba(13,38,76,0.06); }
  input, button, select, textarea { font:inherit; -webkit-appearance:none; appearance:none; }
  input[type="text"], input[type="password"] { width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e6e9ee; background:#fbfdff; font-size:15px; color:#0b1220; outline:none; }
  input::placeholder { color:#9aa4b2; opacity:1; }

  .btn { display:inline-block; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:600; font-size:14px; }
  .btn-primary { background:#0b74ff; color:#fff; }
  .btn-ghost { background:transparent; color:#0b74ff; border:1px solid rgba(11,116,255,0.12); }
  .btn-green { background:#0fb47a; color:#fff; }

  .muted { color:#6b7785; font-size:13px; margin-top:10px; }

  .placesWrap { max-height:300px; overflow:auto; border-radius:10px; border:1px solid #eef2f6; margin-top:8px; }
  table { width:100%; border-collapse:collapse; font-size:14px; }
  th, td { padding:10px 12px; border-bottom:1px solid #f3f6f9; text-align:left; vertical-align:middle; }
  th { background:#fbfdff; font-weight:600; position:sticky; top:0; }
</style>
</head>
<body>

<div id="blockedDevice" aria-hidden="false">
  <div id="blockedDevice-inner">
    <h1>Unsupported Device</h1>
    <p>This tool is only available on mobile phones. Open this page on your phone.</p>
  </div>
</div>

<script>
(function(){
  function isMobile() {
    const ua = navigator.userAgent || '';
    return (/Mobi|Android|iPhone|iPad|iPod|Mobile/i).test(ua) && window.innerWidth <= 600;
  }

  if(!isMobile()){
    document.body.style.overflow='hidden';
    return;
  }

  const blocked = document.getElementById('blockedDevice');
  blocked.parentNode.removeChild(blocked);
  document.body.style.overflow='';

  (function(){

    const STORED_HASH = "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8";

    function sha256Hex(str){ 
      const enc = new TextEncoder().encode(str); 
      return crypto.subtle.digest('SHA-256',enc).then(buf=>Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''));
    }

    function setCookie(name,value,days){ const maxAge = days?days*24*60*60:0; document.cookie=name+'='+encodeURIComponent(value)+'; path=/; max-age='+maxAge;}
    function getCookie(name){ const m=document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]+)'); return m?decodeURIComponent(m[2]):null; }

    const root = document.createElement('div');
    root.className='container';
    document.body.appendChild(root);

    if(getCookie('embargo_auth')==='1'){ buildMainUI(); return; }
    buildLockUI();

    function buildLockUI(){
      root.innerHTML='';
      const h2=document.createElement('h2'); h2.textContent='Embargo NFC Debug'; root.appendChild(h2);

      const box=document.createElement('div'); box.style.marginTop='10px'; root.appendChild(box);
      const pwd=document.createElement('input'); pwd.type='password'; pwd.placeholder='Password'; box.appendChild(pwd);
      const btn=document.createElement('button'); btn.textContent='Unlock'; btn.className='btn btn-primary'; btn.style.marginTop='10px'; box.appendChild(btn);
      const msg=document.createElement('div'); msg.className='muted'; box.appendChild(msg);

      btn.addEventListener('click',()=>{
        sha256Hex(pwd.value||'').then(hash=>{
          if(hash===STORED_HASH){ setCookie('embargo_auth','1',30); buildMainUI(); }
          else msg.textContent='Incorrect password.';
        });
      });

      pwd.addEventListener('keydown', e=>{ if(e.key==='Enter') btn.click(); });
    }

    function buildMainUI(){
      root.innerHTML='';
      const h2=document.createElement('h2'); h2.textContent='Embargo NFC Debug & Writer'; root.appendChild(h2);

      const statusPre=document.createElement('pre'); statusPre.style.marginTop='12px'; root.appendChild(statusPre);

      statusPre.textContent='--- WebNFC Debug ---\n';
      statusPre.textContent+='NDEFReader in window: '+('NDEFReader' in window)+'\n';
      statusPre.textContent+='NDEFWriter in window: '+('NDEFWriter' in window)+'\n';
      statusPre.textContent+='navigator.nfc: '+(navigator.nfc||'undefined')+'\n';
      statusPre.textContent+='User-Agent: '+navigator.userAgent+'\n';
      statusPre.textContent+='Window width: '+window.innerWidth+'\n';

      const testBtn=document.createElement('button'); testBtn.textContent='Test NFC Write'; testBtn.className='btn btn-green'; testBtn.style.marginTop='12px'; root.appendChild(testBtn);

      testBtn.addEventListener('click',async()=>{
        if(!('NDEFWriter' in window)){ statusPre.textContent+='Web NFC not supported.\n'; return; }
        try{
          const writer=new NDEFWriter();
          statusPre.textContent+='Attempting to write "Test NFC"\n';
          await writer.write("Test NFC");
          statusPre.textContent+='Write success!\n';
        }catch(e){
          statusPre.textContent+='Write failed: '+(e.name||'')+' - '+(e.message||'')+'\n';
        }
      });

    }

  })();
})();
</script>

</body>
</html>
